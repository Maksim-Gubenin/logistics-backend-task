# logistics-backend-task: –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏ –∏ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–æ–π

–†–µ—à–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è, –≤–∫–ª—é—á–∞—é—â–µ–µ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–π —Å—Ö–µ–º—ã –ë–î, —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É SQL-–∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ REST-—Å–µ—Ä–≤–∏—Å–∞ –Ω–∞ —Å—Ç–µ–∫–µ FastAPI.

## üìã –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –¢–ó

–ü—Ä–æ–µ–∫—Ç –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –ø—É–Ω–∫—Ç—ã –∑–∞–¥–∞–Ω–∏—è:
1. **–°–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ —Å—Ö–µ–º–∞ –ë–î** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π.
2. **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ SQL-–∑–∞–ø—Ä–æ—Å—ã** (—Å—É–º–º–∞ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º, –¥–µ—Ä–µ–≤–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –¢–û–ü-5 —Ç–æ–≤–∞—Ä–æ–≤).
3. **–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω REST-—Å–µ—Ä–≤–∏—Å** ¬´–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –≤ –∑–∞–∫–∞–∑¬ª —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –∏ –∑–∞—â–∏—Ç–æ–π –æ—Ç race conditions.

---

## üåü –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

*   **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å:** –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç—ã (API -> ORM -> DB) —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞ `asyncio`.
*   **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `SELECT FOR UPDATE` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –æ—Å—Ç–∞—Ç–∫–æ–≤ —Ç–æ–≤–∞—Ä–∞ –ø—Ä–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö.
*   **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** Unit –∏ Integration —Ç–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º >90% –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø—Ä–æ–≥–æ–Ω–æ–º –≤ CI.
*   **Infrastructure as Code:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º —á–µ—Ä–µ–∑ `Docker Compose`, `Makefile` –∏ `entrypoint` —Å–∫—Ä–∏–ø—Ç—ã.
*   **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:** –°—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è `mypy` –∏ –ª–∏–Ω—Ç–∏–Ω–≥ `ruff`.

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã
```mermaid
graph TD
    subgraph "–ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –∑–æ–Ω–∞"
        User((–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å))
    end

    subgraph "–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞"
        API[FastAPI Application]
        DB[(PostgreSQL)]
        Migration[Alembic / Migrations]
    end

    User -->|REST API| API
    API -->|Async Connection| DB
    Migration -->|Apply Schema| DB
    API -.->|Environment Variables| DB
```

---

## üóÑÔ∏è –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö (–ü—É–Ω–∫—Ç 1)

–ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –ø–æ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–º—É –ø—Ä–∏–Ω—Ü–∏–ø—É:
*   **–ò–µ—Ä–∞—Ä—Ö–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ `parent_id` (Adjacency List), —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥–µ—Ä–µ–≤–æ –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏.
*   **–ó–∞–∫–∞–∑—ã:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ —Å–≤—è–∑—å Many-to-Many –º–µ–∂–¥—É `Order` –∏ `Nomenclature` —Å —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ü–µ–Ω—ã –Ω–∞ –º–æ–º–µ–Ω—Ç –ø–æ–∫—É–ø–∫–∏ –≤ `OrderItem`.

**–î–∏–∞–≥—Ä–∞–º–º–∞ –ë–î:**

<img width="732" height="418" alt="–î–∏–∞–≥—Ä–∞–º–º–∞ –ë–î drawio" src="https://github.com/user-attachments/assets/fbc0dfb4-8ad0-4dc0-8879-eb629d3bdf4e" />

---

## üìä SQL –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (–ü—É–Ω–∫—Ç 2)

–í —Ä–∞–º–∫–∞—Ö –∑–∞–¥–∞–Ω–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫. 
–ü–æ–ª–Ω—ã–π –∫–æ–¥ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —Ñ–∞–π–ª–µ **[solution.sql](./docs/solution.sql)**.

### –û—Å–Ω–æ–≤–Ω—ã–µ –æ—Ç—á–µ—Ç—ã:
*   **–°—É–º–º–∞ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º:** –†–∞—Å—á–µ—Ç LTV (Lifetime Value) –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–∫–∞–∑–æ–≤.
*   **–î–µ—Ä–µ–≤–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:** –ê–Ω–∞–ª–∏–∑ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ –∫–∞—Ç–∞–ª–æ–≥–∞ (–ø–æ–¥—Å—á–µ—Ç –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ 1-–≥–æ —É—Ä–æ–≤–Ω—è).
*   **–¢–û–ü-5 –ü—Ä–æ–¥–∞–∂:** View –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ 1-–≥–æ —É—Ä–æ–≤–Ω—è —á–µ—Ä–µ–∑ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (CTE).

> **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:** –î–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –Ω–∞–≥—Ä—É–∑–∫–µ –≤ —Ç—ã—Å—è—á–∏ –∑–∞–∫–∞–∑–æ–≤ –≤ –¥–µ–Ω—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –Ω–∞ –ø–æ–ª—è –¥–∞—Ç, –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Materialized Views –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö –æ—Ç—á–µ—Ç–æ–≤.

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (Prod-ready)
–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω–∏—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç Gunicorn:
```bash
    cp .env.template .env
    docker compose up --build
```
–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API: http://localhost:8000/docs

2. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞
–í–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î, –º–∏–≥—Ä–∞—Ü–∏–∏, —Å–∏–¥–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö –∏ –æ—Ç—á–µ—Ç –æ –ø–æ–∫—Ä—ã—Ç–∏–∏:
```bash
  make test
```

3. –ù–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–π –ë–î (Seed)
–î–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–∫–ª–∏–µ–Ω—Ç—ã, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —Ç–æ–≤–∞—Ä—ã) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è debug –ø—Ä–æ—Ñ–∏–ª—å:
```bash
  docker compose --profile debug run db_seeder
```

---

## ‚úÖ CI/CD –ü–∞–π–ø–ª–∞–π–Ω
–í –ø—Ä–æ–µ–∫—Ç–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω GitHub Actions, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏ –∫–∞–∂–¥–æ–º PR:
* –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∏–ª—å –∫–æ–¥–∞ (ruff).
* –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–∏–ø–∏–∑–∞—Ü–∏—é (mypy).
* –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ç–µ—Å—Ç—ã –≤ Docker-–æ–∫—Ä—É–∂–µ–Ω–∏–∏.
* –ë–ª–æ–∫–∏—Ä—É–µ—Ç Merge, –µ—Å–ª–∏ –ø–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞ (coverage) —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ–Ω–µ–µ 80%.


## –ê–≤—Ç–æ—Ä: 

- **–ú–∞–∫—Å–∏–º –ì—É–±–µ–Ω–∏–Ω**
- **telegram**: @SKDM25
- **mail**: maksimgubenin@mail.ru
